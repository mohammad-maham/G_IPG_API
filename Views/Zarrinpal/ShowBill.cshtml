@using G_IPG_API.Models
@using G_IPG_API.Models.DataModels
@using Newtonsoft.Json
@model LinkRequest
@{
    ViewData["Title"] = "صورتحساب";

    var confirmInfo = ViewBag.ConfirmInfo != null ? (string)ViewBag.ConfirmInfo : string.Empty;
    var errorCode = ViewBag.ErrorCode != null ? (string)ViewBag.ErrorCode : string.Empty;

    var bill = JsonConvert.DeserializeObject<FactorDataModel>(Model.FactorDetail);

}

<style>
    .blueHeader {
        margin-top: 100px;
        color: blue;
    }

    .center {
        text-align: center;
    }

    .body {
        text-align: right;
        direction: rtl;
    }

    .card {
        box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2);
        transition: 0.3s;
        width: 100%;
        border-radius: 5px;
        padding: 10px;
    }

        .card:hover {
            box-shadow: 0 8px 16px 0 rgba(0,0,0,0.2);
        }

    .factorDetail {
        border-radius: 5px 5px 0 0;
        padding: 20px;
    }

    .container {
        padding: 2px 16px;
    }

    .payBtn {
        margin-right: 20px;
    }

    .invoice {
        background: #fff;
        padding: 20px
    }

    .invoice-company {
        font-size: 20px
    }

    .invoice-header {
        background: #f0f3f4;
        padding: 20px
    }

    .invoice-date,
    .invoice-from,
    .invoice-to {
        display: table-cell;
        width: 1%
    }

    .invoice-from,
    .invoice-to {
        padding-right: 20px;
        border-right: solid;
        border-color: gray;
        border-radius: 00px;
        border-width: 1px;
        margin: 30px;
    }

        .invoice-date .date,
        .invoice-from strong,
        .invoice-to strong {
            font-size: 16px;
            font-weight: 600
        }

    .invoice-date {
        text-align: right;
        padding-left: 20px
    }

    .invoice-price {
        background: #f0f3f4;
        display: table;
        width: 100%
    }

        .invoice-price .invoice-price-left,
        .invoice-price .invoice-price-right {
            display: table-cell;
            padding: 20px;
            font-size: 20px;
            font-weight: 600;
            width: 75%;
            position: relative;
            vertical-align: middle
        }

            .invoice-price .invoice-price-left .sub-price {
                display: table-cell;
                vertical-align: middle;
                padding: 0 20px
            }

        .invoice-price small {
            font-size: 12px;
            font-weight: 400;
            display: block
        }

        .invoice-price .invoice-price-row {
            display: table;
            float: left
        }

        .invoice-price .invoice-price-right {
            width: 25%;
            background: #2d353c;
            color: #fff;
            font-size: 28px;
            text-align: right;
            vertical-align: bottom;
            font-weight: 300
        }

            .invoice-price .invoice-price-right small {
                display: block;
                opacity: .6;
                position: absolute;
                top: 10px;
                left: 10px;
                font-size: 12px
            }

    .invoice-footer {
        border-top: 1px solid #ddd;
        padding-top: 10px;
        font-size: 10px
    }

    .invoice-note {
        color: #999;
        margin-top: 80px;
        font-size: 85%
    }

    .invoice > div:not(.invoice-footer) {
        margin-bottom: 20px
    }

    .btn.btn-white, .btn.btn-white.disabled, .btn.btn-white.disabled:focus, .btn.btn-white.disabled:hover, .btn.btn-white[disabled], .btn.btn-white[disabled]:focus, .btn.btn-white[disabled]:hover {
        color: #2d353c;
        background: #fff;
        border-color: #d9dfe3;
    }

</style>
<div class="body">
    <div>

        <div class="col-12">
            <h6 class="blueHeader">صورتحساب </h6>
        </div>
    </div>
    <img src="~/content/img/400x168.jpg" />
    <div class="card">

        <div id="prefactorContainer" class="body">
            <div class="invoice-header">
                <div class="center">
                    <img src="http://194.60.231.81:7122/Content/assets/img/login-image.png" width="100" height="100" class="center" />
                </div>
                <div class="container">
                    <div class="row">
                        <div class="col-sm">
                            <div class="invoice-from">
                                <address class="m-t-5 m-b-5">
                                    <strong class="text-inverse">مشخصات خریدار</strong><br>
                                    نام مشتری : @bill.Header.CutomerName<br>
                                    شناسه مشتری: @bill.Header.CustomerId<br>
                                    شماره تلفن: @bill.Header.CustomerTelephone<br>
                                    شماره موبایل: @bill.Header.CustomerMobile<br>
                                </address>
                            </div>
                        </div>
                        <div class="col-sm">
                            <div class="invoice-to">
                                <strong class="text-inverse">مشخصات سبد</strong><br>
                                <address class="m-t-5 m-b-5">
                                    شناسه صورتحساب: @bill.Header.FactorId <br>
                                    عنوان صورتحساب: @bill.Header.FactorTitle <br>
                                    تاریخ صدور صورتحساب نهایی: @bill.Header.CreateDate<br>
                                </address>
                            </div>
                        </div>
                        <div class="col-sm">
                            <div class="invoice-to">
                                <strong class="text-inverse">اطلاعات پرداخت</strong><br>
                                <address class="m-t-5 m-b-5">
                                    وضعیت پرداخت:
                                    <strong style="color:@(string.IsNullOrEmpty(confirmInfo) ? "Red" : "Green")">
                                        @(string.IsNullOrEmpty(confirmInfo) ? "پرداخت نشده" : "پرداخت شده") <br>
                                    </strong>
                                    کد رهگیری:
                                    <strong style="color:@(string.IsNullOrEmpty(confirmInfo) ? "Red" : "Green")">
                                        @(string.IsNullOrEmpty(confirmInfo) ? confirmInfo : "-")<br>
                                    </strong>
                                    تاریخ پرداخت:
                                    <strong style="color:@(string.IsNullOrEmpty(confirmInfo)? "Red" : "Green")">
                                        @(string.IsNullOrEmpty(confirmInfo) ? confirmInfo : "-")<br>
                                    </strong>
                                </address>
                            </div>
                        </div>
                    </div>
                </div>


            </div>
            <legend>آیتم های صورتحساب</legend>
            <div style=" overflow: auto;">
                <table id="bill" class="table table-striped table-bordered">
                        <tr>
                            <th style="width: 30px;">ردیف</th>
                            <th style="width: 150px;"> عنوان سرویس </td>
                            <th style="width: 200px;"> قیمت هر واحد</td>
                            <th style="width: 100px;">تعداد</td>
                            <th style="width: 90px;"> مبلغ تخفیف</td>
                            <th style="width: 90px;"> بدهکاری</td>
                            <th style="width: 90px;"> بستانکاری</td>
                            <th style="width: 90px;"> توضیح</td>
                        </tr>
                    <tbody>


                        @foreach (var item in bill.Items)
                        {
                            <tr>
                                <td>i+1</td>
                                <td>@item.ItemTitle</td>
                                <td>@item.ItemSumPrice ریال</td>
                                <td>@item.ItemCount @item.ItemUnitType</td>
                                <td>@item.ItemDiscount  ریال</td>
                                <td>@item.ItemSumPrice  ریال  </td>
                                <td>@item.ItemSumPrice  ریال </td>
                                <td>@item.ItemDesctription </td>
                            </tr>

                        }
                        <tr style="background-color: lightblue;">
                            <td colspan="3"><b> جمع کل صورتحساب: @bill.Footer.FactorSumPrice   ریال</b></td>

                            <td colspan="5">
                                <b>
                                    جمع کل با محاسبه @bill.Footer.FactorVAT*100 درصد مالیات بر ارزش افزوده:
                                    @bill.Footer.FactorSumPriceByVAT   ریال
                                </b>
                            </td>

                        </tr>
                    </tbody>
                </table>
                <hr>
                <div class="invoice-from">
                    <address class="m-t-5 m-b-5">
                        <strong class="text-inverse">مشخصات فروشنده</strong><br>
                        نام شرکت : @bill.Footer.SellerName<br>
                        شماره تماس: @bill.Footer.SellerTelephone[0]<br>
                        آدرس: @bill.Footer.SellerAddress[0]<br>
                    </address>
                </div>
            </div>
        </div>
        <div>
            <hr>
            @if (string.IsNullOrEmpty(errorCode))
            {
                <div>

                    <form action="@Url.Action("Payment")" method="get" ngNoForm #FormElement>
                        <input type="hidden" value="@Model.Guid" name="guid" />
                        <div>
                            <button type="button" class="btn btn-primary col-3" (click)="printPreFactor()">چاپ</button>
                            <button class="btn btn-success payBtn col-3" type="submit">
                                پرداخت
                            </button>
                        </div>
                    </form>
                </div>
            }
            @if (!string.IsNullOrEmpty(errorCode))
            {
                <p>@errorCode</p>
            }
        </div>
    </div>

</div>
